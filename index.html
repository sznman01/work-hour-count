<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šç­å·¥æ™‚è¨ˆç®—å™¨</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .shadow-card { box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .bounce { animation: bounce 0.5s ease-in-out; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 to-indigo-100 min-h-screen p-4">
    <div id="app" class="max-w-md mx-auto">
        <!-- é ‚ç½®æœ¬æœˆç¸½å·¥æ™‚ -->
        <div class="bg-white/80 backdrop-blur-sm rounded-3xl p-8 mb-6 shadow-card shadow-pink-200 slide-up">
            <div class="text-center">
                <div class="text-3xl font-bold text-gray-800 mb-2">{{ formatMonthTotal }}</div>
                <div class="text-sm text-gray-500 mb-4">æœ¬æœˆç¸½å·¥æ™‚ (å°æ™‚)</div>
                <div class="text-xs bg-pink-100 text-pink-600 px-3 py-1 rounded-full font-medium">
                    {{ currentMonth }}æœˆ
                </div>
            </div>
        </div>

        <!-- æ–°å¢å·¥ä½œæ—¥æŒ‰éˆ•å¡ç‰‡ (éš±è—è¡¨æ ¼) -->
        <div v-if="!showAddForm" class="bg-white/80 backdrop-blur-sm rounded-3xl p-8 mb-6 shadow-card shadow-blue-200 text-center cursor-pointer hover:shadow-xl transform hover:-translate-y-2 transition-all duration-300" @click="showAddForm = true">
            <div class="text-4xl mb-4">â•</div>
            <div class="text-xl font-bold text-gray-800 mb-2">æ–°å¢å·¥ä½œæ—¥</div>
            <div class="text-sm text-gray-500">é»æ“Šè¼¸å…¥ä»Šæ—¥å·¥æ™‚</div>
        </div>

        <!-- æ–°å¢å·¥ä½œæ—¥è¼¸å…¥è¡¨æ ¼ (é»æ“ŠæŒ‰éˆ•å¾Œé¡¯ç¤º) -->
        <div v-if="showAddForm" class="bg-white/90 backdrop-blur-sm rounded-3xl p-6 mb-6 shadow-card shadow-blue-200 slide-up">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800">â• æ–°å¢å·¥ä½œæ—¥</h2>
                <button @click="showAddForm = false" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">âœ•</button>
            </div>
            
            <div class="space-y-4">
                <!-- æ—¥æœŸé¸æ“‡ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ğŸ“… æ—¥æœŸ</label>
                    <input 
                        v-model="newWorkDay.date" 
                        type="date" 
                        class="w-full p-4 border border-gray-200 rounded-2xl focus:ring-4 focus:ring-pink-200 focus:border-pink-400 text-lg"
                        :max="today"
                    >
                </div>

                <!-- å·¥æ™‚é¡å‹é¸æ“‡ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">â° å·¥æ™‚é¡å‹</label>
                    <select 
                        v-model="newWorkDay.type" 
                        @change="handleTypeChange"
                        class="w-full p-4 border border-gray-200 rounded-2xl focus:ring-4 focus:ring-blue-200 focus:border-blue-400 text-lg appearance-none bg-white"
                    >
                        <option value="">é¸æ“‡é¡å‹</option>
                        <option value="TC">TC (+9.25h)</option>
                        <option value="B">B (+10.72h)</option>
                        <option value="C">C (+9.5h)</option>
                        <option value="BC">BC (+10.25h)</option>
                        <option value="SP">SP (+12.25h)</option>
                        <option value="SPC">SPC (+11.25h)</option>
                        <option value="SL">SL (9.6h)</option>
                        <option value="TIL">TIL (-9.6h)</option>
                        <option value="custom">è‡ªè¨‚æ™‚æ•¸</option>
                    </select>
                </div>

                <!-- OT é¸æ“‡ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">â­ OT åŠ ç­</label>
                    <select 
                        v-model="newWorkDay.ot" 
                        class="w-full p-4 border border-gray-200 rounded-2xl focus:ring-4 focus:ring-purple-200 focus:border-purple-400 text-lg appearance-none bg-white"
                    >
                        <option value="0">ç„¡ OT</option>
                        <option value="0.5">+0.5 å°æ™‚</option>
                        <option value="1">+1 å°æ™‚</option>
                        <option value="1.5">+1.5 å°æ™‚</option>
                        <option value="2">+2 å°æ™‚</option>
                        <option value="2.5">+2.5 å°æ™‚</option>
                        <option value="3">+3 å°æ™‚</option>
                    </select>
                </div>

                <!-- è‡ªè¨‚æ™‚æ•¸è¼¸å…¥ -->
                <div v-if="newWorkDay.type === 'custom'" class="pt-2">
                    <label class="block text-sm font-medium text-gray-700 mb-2">âœï¸ è‡ªè¨‚å·¥æ™‚ (å°æ™‚)</label>
                    <input 
                        v-model.number="newWorkDay.customHours" 
                        type="number" 
                        step="0.1"
                        min="-24" max="24"
                        class="w-full p-4 border border-gray-200 rounded-2xl focus:ring-4 focus:ring-indigo-200 focus:border-indigo-400 text-lg"
                        placeholder="è¼¸å…¥å·¥æ™‚..."
                    >
                </div>

                <!-- å³æ™‚é è¦½ç¸½æ™‚æ•¸ -->
                <div v-if="previewHours !== null" class="bg-green-50 border-2 border-green-200 rounded-2xl p-4 text-center">
                    <div class="text-sm text-gray-600 mb-1">é è¦½ç¸½å·¥æ™‚</div>
                    <div class="text-2xl font-bold text-green-700">{{ previewHours.toFixed(2) }} å°æ™‚</div>
                </div>

                <!-- æ–°å¢æŒ‰éˆ• -->
                <button 
                    @click="addWorkDay"
                    :disabled="!isValidInput"
                    class="w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white font-bold py-4 px-6 rounded-2xl text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-200 bounce"
                >
                    âœ¨ å„²å­˜å·¥ä½œæ—¥
                </button>
            </div>
        </div>

        <!-- æœˆæ­·å¡ç‰‡ -->
        <div class="bg-white/80 backdrop-blur-sm rounded-3xl p-6 shadow-card shadow-indigo-200 slide-up">
            <h2 class="text-xl font-bold text-gray-800 mb-6 text-center">ğŸ“Š æœ¬æœˆå·¥æ™‚æ˜ç´°</h2>
            
            <div class="grid grid-cols-7 gap-2 text-center mb-4">
                <div class="font-bold text-gray-700 p-2 bg-gray-100 rounded-xl">æ—¥</div>
                <div class="font-bold text-gray-700 p-2 bg-gray-100 rounded-xl">ä¸€</div>
                <div class="font-bold text-gray-700 p-2 bg-gray-100 rounded-xl">äºŒ</div>
                <div class="font-bold text-gray-700 p-2 bg-gray-100 rounded-xl">ä¸‰</div>
                <div class="font-bold text-gray-700 p-2 bg-gray-100 rounded-xl">å››</div>
                <div class="font-bold text-gray-700 p-2 bg-gray-100 rounded-xl">äº”</div>
                <div class="font-bold text-gray-700 p-2 bg-gray-100 rounded-xl">å…­</div>
            </div>

            <div class="grid grid-cols-7 gap-2 max-h-96 overflow-y-auto pb-4">
                <div 
                    v-for="day in calendarDays" 
                    :key="day.date"
                    class="p-3 rounded-xl min-h-[60px] flex flex-col justify-center cursor-pointer hover:scale-105 transition-all duration-200 group relative"
                    :class="getDayClass(day)"
                    @click="editDay(day.date)"
                >
                    <div class="font-bold text-sm mb-1 leading-tight">{{ day.day }}</div>
                    <div v-if="day.hours !== null" class="text-xs leading-tight">
                        {{ formatHours(day.hours) }}
                        <div v-if="day.ot > 0" class="text-yellow-500 text-[10px] mt-1">â­{{ day.ot }}</div>
                    </div>
                    <div v-else class="text-gray-400 text-xs leading-tight">â€”</div>
                </div>
            </div>
        </div>

        <!-- ç·¨è¼¯å½ˆçª— -->
        <div v-if="showEditModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-3xl p-8 w-full max-w-sm shadow-2xl animate-pulse">
                <h3 class="text-xl font-bold text-gray-800 mb-4 text-center">ç·¨è¼¯ {{ editDate }}</h3>
                <input 
                    v-model.number="editHours" 
                    type="number" 
                    step="0.1"
                    class="w-full p-4 border border-gray-200 rounded-2xl mb-4 text-lg text-center font-bold focus:ring-4 focus:ring-green-200"
                    placeholder="è¼¸å…¥å·¥æ™‚..."
                >
                <div class="flex space-x-3">
                    <button 
                        @click="saveEdit"
                        class="flex-1 bg-green-500 text-white font-bold py-3 px-4 rounded-xl text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all"
                    >âœ… ç¢ºå®š</button>
                    <button 
                        @click="cancelEdit"
                        class="flex-1 bg-gray-300 text-gray-700 font-bold py-3 px-4 rounded-xl text-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all"
                    >âŒ å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    currentMonth: new Date().getMonth() + 1,
                    showAddForm: false,
                    workDays: {},
                    newWorkDay: {
                        date: '',
                        type: '',
                        ot: '0',
                        customHours: null
                    },
                    showEditModal: false,
                    editDate: '',
                    editHours: null,
                    workTypes: {
                        'TC': 9.25,
                        'B': 10.72,
                        'C': 9.5,
                        'BC': 10.25,
                        'SP': 12.25,
                        'SPC': 11.25,
                        'SL': 9.6,
                        'TIL': -9.6
                    }
                }
            },
            computed: {
                today() {
                    const today = new Date();
                    return today.toISOString().split('T')[0];
                },
                formatMonthTotal() {
                    const total = this.getMonthTotal();
                    return total.toFixed(2);
                },
                previewHours() {
                    if (!this.isValidInput) return null;
                    const baseHours = this.getHoursForDay();
                    return baseHours + parseFloat(this.newWorkDay.ot);
                },
                isValidInput() {
                    return this.newWorkDay.date && 
                           (this.newWorkDay.type && this.newWorkDay.type !== 'custom' ||
                            (this.newWorkDay.type === 'custom' && this.newWorkDay.customHours !== null && !isNaN(this.newWorkDay.customHours)));
                },
                calendarDays() {
                    const days = [];
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = this.currentMonth - 1;
                    const firstDay = new Date(year, month, 1);
                    const lastDay = new Date(year, month + 1, 0);
                    const startDate = new Date(firstDay);
                    startDate.setDate(startDate.getDate() - firstDay.getDay());

                    for (let i = 0; i < 42; i++) {
                        const date = new Date(startDate);
                        date.setDate(startDate.getDate() + i);
                        
                        const dateKey = date.toISOString().split('T')[0];
                        const workDay = this.workDays[dateKey];
                        
                        days.push({
                            date: dateKey,
                            day: date.getDate(),
                            hours: workDay ? workDay.hours : null,
                            ot: workDay ? (workDay.ot || 0) : 0,
                            type: workDay ? workDay.type : null,
                            isCurrentMonth: date.getMonth() === month
                        });
                    }
                    return days;
                }
            },
            watch: {
                workDays: {
                    handler() {
                        this.saveData();
                    },
                    deep: true
                }
            },
            methods: {
                handleTypeChange() {
                    if (this.newWorkDay.type !== 'custom') {
                        this.newWorkDay.customHours = null;
                    }
                },
                getHoursForDay() {
                    if (this.newWorkDay.type === 'custom') {
                        return parseFloat(this.newWorkDay.customHours) || 0;
                    }
                    return this.workTypes[this.newWorkDay.type] || 0;
                },
                addWorkDay() {
                    if (!this.isValidInput) return;
                    
                    const dateKey = this.newWorkDay.date;
                    const hours = this.getHoursForDay();
                    const totalHours = hours + parseFloat(this.newWorkDay.ot);

                    Vue.set(this.workDays, dateKey, {
                        hours: totalHours,
                        type: this.newWorkDay.type,
                        ot: parseFloat(this.newWorkDay.ot),
                        customHours: this.newWorkDay.type === 'custom' ? hours : null,
                        date: dateKey
                    });

                    // å¼·åˆ¶æ›´æ–°
                    this.$forceUpdate();
                    this.resetForm();
                    
                    // é¡¯ç¤ºæˆåŠŸå‹•ç•«
                    this.showAddForm = false;
                },
                resetForm() {
                    this.newWorkDay = { date: this.today, type: '', ot: '0', customHours: null };
                },
                getMonthTotal() {
                    let total = 0;
                    Object.values(this.workDays).forEach(day => {
                        if (day.date) {
                            const date = new Date(day.date);
                            if (date.getMonth() + 1 === this.currentMonth) {
                                total += day.hours || 0;
                            }
                        }
                    });
                    return total;
                },
                formatHours(hours) {
                    if (hours === null || hours === undefined) return '';
                    return parseFloat(hours).toFixed(2);
                },
                getDayClass(day) {
                    let classes = 'text-gray-600';
                    if (!day.isCurrentMonth) {
                        classes += ' opacity-50';
                    } else if (day.hours !== null && day.hours !== undefined) {
                        if (day.hours > 10) classes += ' bg-emerald-100 border-2 border-emerald-300 shadow-md';
                        else if (day.hours > 0) classes += ' bg-green-100 border-2 border-green-300';
                        else if (day.hours < 0) classes += ' bg-red-100 border-2 border-red-300 shadow-md';
                        else classes += ' bg-yellow-100 border-2 border-yellow-300';
                    } else {
                        classes += ' bg-gray-50 border border-gray-200';
                    }
                    return classes;
                },
                editDay(date) {
                    const workDay = this.workDays[date];
                    if (workDay) {
                        this.editDate = date;
                        this.editHours = workDay.hours;
                        this.showEditModal = true;
                    }
                },
                saveEdit() {
                    if (this.editHours !== null && this.editHours !== undefined && !isNaN(this.editHours)) {
                        Vue.set(this.workDays[this.editDate], 'hours', parseFloat(this.editHours));
                        this.$forceUpdate();
                    }
                    this.cancelEdit();
                },
                cancelEdit() {
                    this.showEditModal = false;
                    this.editDate = '';
                    this.editHours = null;
                },
                saveData() {
                    localStorage.setItem('workDays', JSON.stringify(this.workDays));
                }
            },
            mounted() {
                // è¼‰å…¥ç¾æœ‰æ•¸æ“š
                const savedData = localStorage.getItem('workDays');
                if (savedData) {
                    this.workDays = JSON.parse(savedData);
                }
                // è¨­å®šä»Šå¤©çš„æ—¥æœŸ
                this.newWorkDay.date = this.today;
            }
        }).mount('#app');
    </script>
</body>
</html>
